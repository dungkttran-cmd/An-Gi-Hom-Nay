<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ƒÇn g√¨ h√¥m nay? ‚Äî Global Pro v4</title>
  <meta name="theme-color" content="#ff7b2d" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root{{--accent:#ff7b2d;--bg:#fff6ee;--card:#fff;--muted:#8b6b57;}}
    *{{box-sizing:border-box}}
    body{{font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:#2b2b2b}}
    .header{{background:#fff;padding:18px 24px;border-bottom:1px solid #f0e6de;display:flex;align-items:center;justify-content:space-between}}
    .title{{color:var(--accent);font-weight:800;font-size:22px}}
    .container{{max-width:1200px;margin:18px auto;padding:0 18px}}
    .topbar{{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.06);display:flex;gap:12px;align-items:center}}
    .loc-btn{{background:#27ae60;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;display:flex;gap:8px;align-items:center}}
    .input{{flex:1;display:flex;gap:8px;align-items:center}}
    .input input{{flex:1;padding:12px 14px;border-radius:8px;border:1px solid #eee;background:#faf7f6}}
    .input button{{padding:10px 12px;border-radius:8px;border:none;background:#9aa0a6;color:#fff;cursor:pointer}}
    .tabs{{display:flex;gap:12px;margin-top:16px}}
    .tab{{flex:1;padding:14px;border-radius:8px;background:#fdebd6;text-align:center;cursor:pointer;border:1px solid #f5ded0;display:flex;align-items:center;justify-content:center;gap:8px}}
    .tab.active{{background:var(--accent);color:#fff}}
    .main{{display:grid;grid-template-columns:1fr 340px;gap:18px;margin-top:18px;align-items:start}}
    .left{{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.06)}}
    .grid{{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}}
    .card{{background:#fff;border-radius:10px;padding:12px;border:1px solid #f0e6de;box-shadow:0 2px 6px rgba(0,0,0,0.04);display:flex;flex-direction:column;gap:8px;height:170px}}
    .thumb{{width:100%;height:90px;border-radius:8px;flex-shrink:0;background:#eee;overflow:hidden;display:flex;align-items:center;justify-content:center}}
    .info h4{{margin:0;font-size:16px;color:#d35400}}
    .info .sub{{color:var(--muted);font-size:13px}}
    .meta{{display:flex;justify-content:space-between;align-items:center;gap:8px}}
    .price{{color:var(--accent);font-weight:700}}
    .dist{{color:#2d7a2d;font-weight:600;font-size:13px}}
    .right{{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.06);position:relative;top:0;height:calc(100vh - 140px);overflow:auto}}
    .promo{{background:#fff;padding:12px;border-radius:8px;margin-bottom:12px;border-left:4px solid var(--accent)}}
    .map-modal{{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:90%;height:80%;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.3);z-index:200;display:none;flex-direction:column}}
    .map-header{{padding:8px 12px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}}
    #map{{flex:1;border-radius:0 0 12px 12px}}
    .btn-close{{background:#ff7b2d;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}}
    .footer-note{{margin-top:12px;color:#7a6a5b;font-size:13px;text-align:center}}
    @media (max-width:1000px){{.grid{{grid-template-columns:repeat(2,1fr)}}.main{{grid-template-columns:1fr}}}}
    @media (max-width:600px){{.grid{{grid-template-columns:1fr}}.thumb{{height:66px}}.card{{height:auto}}}}
  </style>
</head>
<body>
  <div class="header"><div class="title">ƒÇn g√¨ h√¥m nay?</div><div class="small">Pro v4</div></div>
  <div class="container">
    <div class="topbar">
      <button class="loc-btn" onclick="getUserLocation()">üìç L·∫•y v·ªã tr√≠ hi·ªán t·∫°i</button>
      <div class="input">
        <input id="manualAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ho·∫∑c khu v·ª±c..." />
        <button onclick="useManualAddress()">T√¨m</button>
      </div>
      <div style="width:120px;display:flex;justify-content:flex-end"><button onclick="refreshAll()" style="background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer">L√†m m·ªõi</button></div>
    </div>

    <div class="tabs">
      <div id="tab-morning" class="tab" onclick="selectMeal('morning')">üåÖ Bu·ªïi s√°ng</div>
      <div id="tab-lunch" class="tab active" onclick="selectMeal('lunch')">‚òÄÔ∏è Bu·ªïi tr∆∞a</div>
      <div id="tab-dinner" class="tab" onclick="selectMeal('dinner')">üåô Bu·ªïi t·ªëi</div>
    </div>

    <div class="main">
      <div class="left">
        <h2 id="mealTitle">Bu·ªïi tr∆∞a</h2>
        <div id="status" class="small">T√¨nh tr·∫°ng: Ch∆∞a x√°c ƒë·ªãnh v·ªã tr√≠</div>
        <div class="grid" id="cards"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px"><button onclick="shuffleSuggestion()" style="background:#27ae60;color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer">G·ª£i √Ω ng·∫´u nhi√™n</button></div>
        <div class="footer-note">L∆∞u √Ω: b·∫£n ƒë·ªì c·∫ßn Google Maps API Key ho·∫°t ƒë·ªông. H√£y c·∫•u h√¨nh key trong Google Cloud Console (gi·ªõi h·∫°n HTTP referrer).</div>
      </div>

      <div class="right">
        <h3 style="color:var(--accent);margin-top:0">Khuy·∫øn m·∫°i h√¥m nay</h3>
        <div id="promos"></div>
      </div>
    </div>
  </div>

  <div id="mapModal" class="map-modal">
    <div class="map-header"><div id="mapTitle">B·∫£n ƒë·ªì</div><button class="btn-close" onclick="closeMap()">ƒê√≥ng</button></div>
    <div id="map"></div>
  </div>

<script>
const GOOGLE_API_KEY = "AIzaSyA0KKa4ysubldgYy00jXdD_8vrJJdhRfCQ";
const DATA = {{
  "VN": {{
    "morning":[{{"name":"Ph·ªü b√≤","shop":"Ph·ªü Th√¨n","addr":"13 L√≤ ƒê√∫c, H√† N·ªôi","price":"45.000 ƒë"}}],
    "lunch":[
      {{"name":"Ph·ªü Cu·ªën Th·∫≠p C·∫©m","shop":"Ph·ªü Cu·ªën H∆∞∆°ng Mai","addr":"25 Ng≈© X√£, Tr√∫c B·∫°ch, H√† N·ªôi","price":"75.000 ƒë"}},
      {{"name":"B√∫n Ch·∫£ ƒê·∫∑c Bi·ªát","shop":"B√∫n Ch·∫£ ƒê·∫∑c Kim","addr":"1 H√†ng M√†nh, Ho√†n Ki·∫øm, H√† N·ªôi","price":"65.000 ƒë"}},
      {{"name":"C∆°m Rang D∆∞a B√≤","shop":"C∆°m Rang H·∫±ng","addr":"107 M√£ M√¢y, Ho√†n Ki·∫øm, H√† N·ªôi","price":"55.000 ƒë"}},
      {{"name":"B√°nh M√¨ Pate Tr·ª©ng","shop":"B√°nh M√¨ 25","addr":"25 H√†ng C√°, Ho√†n Ki·∫øm, H√† N·ªôi","price":"30.000 ƒë"}},
      {{"name":"Mi·∫øn Ngan Tr·ªôn","shop":"Mi·∫øn Ngan V·∫°n Ph√∫c","addr":"61 H√†ng B√¥ng, Ho√†n Ki·∫øm, H√† N·ªôi","price":"40.000 ƒë"}},
      {{"name":"B√∫n ƒê·∫≠u M·∫Øm T√¥m","shop":"B√∫n ƒê·∫≠u Ng√µ G·∫°ch","addr":"4 Ng√µ G·∫°ch, H√† N·ªôi","price":"80.000 ƒë"}},
      {{"name":"B√°nh X√®o T√¥m Th·ªãt","shop":"B√°nh X√®o S√°u Ph∆∞·ªõc","addr":"74 H√†ng Tre, Ho√†n Ki·∫øm, H√† N·ªôi","price":"70.000 ƒë"}},
      {{"name":"C∆°m Ni√™u G√† Rang Mu·ªëi","shop":"C∆°m Ni√™u Kombo","addr":"110-112 Hai B√† Tr∆∞ng, H√† N·ªôi","price":"120.000 ƒë"}},
      {{"name":"Pizza Margherita","shop":"Pizza 4P's Phan B·ªôi Ch√¢u","addr":"24 Phan B·ªôi Ch√¢u, H√† N·ªôi","price":"180.000 ƒë"}}
    ],
    "dinner":[],
    "promos":[{{"title":"Gi·∫£m 10% cho combo Ph·ªü Cu·ªën","shop":"Ph·ªü Cu·ªën H∆∞∆°ng B·∫øn","misc":"26 Nguy·ªÖn Kh·∫Øc Hi·∫øu","dist":"350m"}}]
  }},
  "JP": {{
    "lunch":[
      {{"name":"Sushi Set","shop":"Sushi Bar","addr":"Ginza, Tokyo","price":"¬•1500"}},
      {{"name":"Ramen","shop":"Ramen House","addr":"Shinjuku, Tokyo","price":"¬•900"}},
      {{"name":"Ph·ªü (VN)","shop":"Pho Tokyo","addr":"Shibuya, Tokyo","price":"¬•900","owner":"VN"}}
    ],
    "promos":[{{"title":"Coupon sushi 10% (Tokyo)","shop":"Sushi Bar","misc":"Ginza","dist":"1.2km"}}]
  }},
  "US": {{
    "lunch":[
      {{"name":"Cheeseburger","shop":"Burger House","addr":"5th Ave, NY","price":"$10"}},
      {{"name":"Ph·ªü (VN)","shop":"Pho & Friends","addr":"Little Saigon, CA","price":"$12","owner":"VN"}}
    ],
    "promos":[]
  }},
  "FR": {{
    "lunch":[{{"name":"Croissant & Coffee","shop":"Boulangerie","addr":"Paris","price":"‚Ç¨3"}}],
    "promos":[]
  }},
  "DE": {{
    "lunch":[{{"name":"Currywurst","shop":"Curry House","addr":"Frankfurt Hauptbahnhof, Frankfurt","price":"‚Ç¨6"}},{{"name":"Pretzel & Sausage","shop":"Brezel Stand","addr":"R√∂mer, Frankfurt","price":"‚Ç¨5"}}],
    "promos":[{{"title":"Gi·∫£m 20% Currywurst (Frankfurt)","shop":"Curry House","misc":"Frankfurt Hauptbahnhof","dist":"800m"}}]
  }}
}};

// state
let userLat=null,userLon=null,detectedCountry='VN',currentMeal='lunch';
let map, geocoder, markers = [];

// helpers
function detectCountryFallback(){ const lang=(navigator.language||'').toLowerCase(); if(lang.startsWith('vi')) return 'VN'; if(lang.startsWith('ja')) return 'JP'; if(lang.startsWith('fr')) return 'FR'; if(lang.startsWith('de')) return 'DE'; if(lang.startsWith('en')) return 'US'; return 'VN'; }
function updateStatus(msg){ document.getElementById('status').innerText = 'T√¨nh tr·∫°ng: ' + msg; }

document.addEventListener('DOMContentLoaded', ()=>{ selectMeal('lunch'); renderPromos(); });

function selectMeal(meal){ currentMeal=meal; ['morning','lunch','dinner'].forEach(m=>document.getElementById('tab-'+m).classList.toggle('active', m===meal)); document.getElementById('mealTitle').innerText = meal==='morning'?'Bu·ªïi s√°ng':meal==='lunch'?'Bu·ªïi tr∆∞a':'Bu·ªïi t·ªëi'; renderCards(); }

function renderCards(){ const c = detectedCountry in DATA ? detectedCountry : 'VN'; const list = (DATA[c] && DATA[c][currentMeal]) ? DATA[c][currentMeal] : (DATA['VN'][currentMeal]||[]); const container=document.getElementById('cards'); container.innerHTML=''; list.slice(0,9).forEach(it=>{ const div=document.createElement('div'); div.className='card'; const imgName = (it.shop.replace(/\W+/g,'_')).substring(0,20)+'.jpg'; div.innerHTML=`<div class="thumb"><img src="assets/${imgName}" style="width:100%;height:100%;object-fit:cover" onerror="this.style.opacity=.25"/></div><div class="info"><h4>${it.name}</h4><div class="sub">${it.shop} ‚Ä¢ ${it.addr}</div><div class="meta"><div class="dist">${randomDist()}</div><div class="price">${it.price||''}</div></div></div><div style="display:flex;justify-content:space-between;align-items:center"><button onclick="openMapFor('${encodeURIComponent(it.shop)}','${encodeURIComponent(it.addr)}')" style="background:var(--accent);color:#fff;border:none;padding:8px;border-radius:8px;cursor:pointer">Maps</button><button onclick="alert('${it.name}\n${it.shop}\n${it.addr}')" style="background:#fff;border:1px solid #eee;padding:8px;border-radius:8px;cursor:pointer">Chi ti·∫øt</button></div>`; container.appendChild(div); }); }

function renderPromos(){ const c = detectedCountry in DATA ? detectedCountry : 'VN'; const promos=(DATA[c]&&DATA[c].promos)?DATA[c].promos:[]; const cont=document.getElementById('promos'); cont.innerHTML = promos.map(p=>`<div class="promo"><strong>${p.title}</strong><div class="small">${p.shop} ¬∑ ${p.misc} ¬∑ ${p.dist}</div></div>`).join('') || '<div class="small">Kh√¥ng c√≥ khuy·∫øn m√£i.</div>'; }

function randomDist(){ const d=(Math.random()*2.5+0.2); return d<1?Math.round(d*1000)+' m':d.toFixed(1)+' km'; }

// Maps
function openMapFor(shopEnc, addrEnc){ const shop=decodeURIComponent(shopEnc); const addr=decodeURIComponent(addrEnc); // open modal and show markers
  document.getElementById('mapModal').style.display='flex'; initMap().then(()=>{ clearMarkers(); // center on address
    geocodeAddress(shop + ' ' + addr).then(loc=>{ map.setCenter(loc); map.setZoom(14); const m=new google.maps.Marker({position:loc,map,title:shop}); markers.push(m); }).catch(()=>{}); if(userLat && userLon){ const u=new google.maps.Marker({position:{lat:userLat,lng:userLon},map,title:'B·∫°n ·ªü ƒë√¢y', icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:'#27ae60',fillOpacity:1,strokeColor:'#fff',strokeWeight:2}}); markers.push(u); } }); }

function closeMap(){ clearMarkers(); document.getElementById('mapModal').style.display='none'; }

function clearMarkers(){ markers.forEach(m=>m.setMap(null)); markers=[]; }

function initMap(){ return new Promise((resolve)=>{ if(map) return resolve(); geocoder = new google.maps.Geocoder(); map = new google.maps.Map(document.getElementById('map'), {center:{lat:21.0278,lng:105.8342},zoom:13}); resolve(); }); }

function geocodeAddress(addr){ return new Promise((resolve,reject)=>{ geocoder.geocode({address:addr}, (results,status)=>{ if(status==='OK' && results[0]){ resolve(results[0].geometry.location); } else reject(status); }); }); }

// location
function getUserLocation(){ if(!navigator.geolocation){ alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.'); return; } updateStatus('ƒêang l·∫•y v·ªã tr√≠...'); navigator.geolocation.getCurrentPosition(async pos=>{ userLat=pos.coords.latitude; userLon=pos.coords.longitude; updateStatus('ƒê√£ l·∫•y v·ªã tr√≠: '+userLat.toFixed(4)+', '+userLon.toFixed(4)); // reverse geocode to get country
  await initMap(); geocoder.geocode({location:{lat:userLat,lng:userLon}}, (results,status)=>{ if(status==='OK' && results[0]){ let cc='VN'; results[0].address_components.forEach(c=>{ if(c.types.includes('country')) cc=c.short_name; }); detectedCountry = cc; renderCards(); renderPromos(); document.getElementById('manualAddress').value = results[0].formatted_address; } else { detectedCountry = detectCountryFallback(); renderCards(); renderPromos(); } }); }, err=>{ let msg='Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠.'; if(err.code===1) msg='B·∫°n ƒë√£ t·ª´ ch·ªëi truy c·∫≠p v·ªã tr√≠.'; updateStatus(msg); }); }

async function useManualAddress(){ const addr=document.getElementById('manualAddress').value.trim(); if(!addr){ alert('Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ.'); return; } updateStatus('ƒêang t√¨m ƒë·ªãa ch·ªâ...'); try{ await initMap(); const loc = await geocodeAddress(addr); userLat = loc.lat(); userLon = loc.lng(); geocoder.geocode({location:loc}, (results,status)=>{ if(status==='OK' && results[0]){ let cc='VN'; results[0].address_components.forEach(c=>{ if(c.types.includes('country')) cc=c.short_name; }); detectedCountry = cc; updateStatus('ƒê√£ x√°c ƒë·ªãnh: '+results[0].formatted_address); document.getElementById('manualAddress').value = results[0].formatted_address; renderCards(); renderPromos(); } else { detectedCountry = detectCountryFallback(); renderCards(); renderPromos(); } }); }catch(e){ updateStatus('Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ'); alert('Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ.'); } }

function shuffleSuggestion(){ const c = detectedCountry in DATA ? detectedCountry : 'VN'; const pool = [].concat(DATA[c].morning||[], DATA[c].lunch||[], DATA[c].dinner||[]); if(!pool.length) return; const it = pool[Math.floor(Math.random()*pool.length)]; alert(it.name + '\n' + it.shop + '\n' + it.addr); }

function refreshAll(){ document.getElementById('manualAddress').value=''; detectedCountry = detectCountryFallback(); userLat=null; userLon=null; renderCards(); renderPromos(); updateStatus('Ch∆∞a x√°c ƒë·ªãnh v·ªã tr√≠'); }

</script>

<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0KKa4ysubldgYy00jXdD_8vrJJdhRfCQ&callback=initMap&libraries=places"></script>
</body>
</html>
