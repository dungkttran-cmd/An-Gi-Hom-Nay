<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ƒÇn g√¨ h√¥m nay? ‚Äî Global Pro v4 (Fixed)</title>
  <meta name="theme-color" content="#ff7b2d" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root { --accent:#ff7b2d; --bg:#fff6ee; --card:#fff; --muted:#8b6b57; }
    * { box-sizing:border-box }
    body { font-family:Inter,Segoe UI,Roboto,Arial,sans-serif; margin:0; background:var(--bg); color:#2b2b2b }
    .header { background:#fff; padding:18px 24px; border-bottom:1px solid #f0e6de; display:flex; align-items:center; justify-content:space-between }
    .title { color:var(--accent); font-weight:800; font-size:22px }
    .container { max-width:1200px; margin:18px auto; padding:0 18px }
    .topbar { background:var(--card); padding:14px; border-radius:10px; box-shadow:0 8px 24px rgba(0,0,0,0.06); display:flex; gap:12px; align-items:center }
    .loc-btn { background:#27ae60; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; display:flex; gap:8px; align-items:center }
    .input { flex:1; display:flex; gap:8px; align-items:center }
    .input input { flex:1; padding:12px 14px; border-radius:8px; border:1px solid #eee; background:#faf7f6 }
    .input button { padding:10px 12px; border-radius:8px; border:none; background:#9aa0a6; color:#fff; cursor:pointer }
    .tabs { display:flex; gap:12px; margin-top:16px }
    .tab { flex:1; padding:14px; border-radius:8px; background:#fdebd6; text-align:center; cursor:pointer; border:1px solid #f5ded0; display:flex; align-items:center; justify-content:center; gap:8px }
    .tab.active { background:var(--accent); color:#fff }
    .main { display:grid; grid-template-columns:1fr 340px; gap:18px; margin-top:18px; align-items:start }
    .left { background:var(--card); padding:18px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.06) }
    .grid { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:12px }
    .card { background:#fff; border-radius:10px; padding:12px; border:1px solid #f0e6de; box-shadow:0 2px 6px rgba(0,0,0,0.04); display:flex; flex-direction:column; gap:8px; height:170px }
    .thumb { width:100%; height:90px; border-radius:8px; flex-shrink:0; background:#eee; overflow:hidden; display:flex; align-items:center; justify-content:center }
    .info h4 { margin:0; font-size:16px; color:#d35400 }
    .info .sub { color:var(--muted); font-size:13px }
    .meta { display:flex; justify-content:space-between; align-items:center; gap:8px }
    .price { color:var(--accent); font-weight:700 }
    .dist { color:#2d7a2d; font-weight:600; font-size:13px }
    .right { background:var(--card); padding:14px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.06); position:relative; top:0; height:calc(100vh - 140px); overflow:auto }
    .promo { background:#fff; padding:12px; border-radius:8px; margin-bottom:12px; border-left:4px solid var(--accent) }
    .map-modal { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:90%; height:80%; background:#fff; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.3); z-index:200; display:none; flex-direction:column }
    .map-header { padding:8px 12px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center }
    #map { flex:1; border-radius:0 0 12px 12px }
    .btn-close { background:#ff7b2d; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer }
    .footer-note { margin-top:12px; color:#7a6a5b; font-size:13px; text-align:center }
    @media (max-width:1000px) { .grid{grid-template-columns:repeat(2,1fr)} .main{grid-template-columns:1fr} }
    @media (max-width:600px) { .grid{grid-template-columns:1fr} .thumb{height:66px} .card{height:auto} }
  </style>
</head>
<body>
  <div class="header"><div class="title">ƒÇn g√¨ h√¥m nay?</div><div class="small">Pro v4</div></div>
  <div class="container">
    <div class="topbar">
      <button class="loc-btn" onclick="getUserLocation()">üìç L·∫•y v·ªã tr√≠ hi·ªán t·∫°i</button>
      <div class="input">
        <input id="manualAddress" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ ho·∫∑c khu v·ª±c..." />
        <button onclick="useManualAddress()">T√¨m</button>
      </div>
      <div style="width:120px;display:flex;justify-content:flex-end"><button onclick="refreshAll()" style="background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer">L√†m m·ªõi</button></div>
    </div>

    <div class="tabs">
      <div id="tab-morning" class="tab" onclick="selectMeal('morning')">üåÖ Bu·ªïi s√°ng</div>
      <div id="tab-lunch" class="tab active" onclick="selectMeal('lunch')">‚òÄÔ∏è Bu·ªïi tr∆∞a</div>
      <div id="tab-dinner" class="tab" onclick="selectMeal('dinner')">üåô Bu·ªïi t·ªëi</div>
    </div>

    <div class="main">
      <div class="left">
        <h2 id="mealTitle">Bu·ªïi tr∆∞a</h2>
        <div id="status" class="small">T√¨nh tr·∫°ng: Ch∆∞a x√°c ƒë·ªãnh v·ªã tr√≠</div>
        <div class="grid" id="cards"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px"><button onclick="shuffleSuggestion()" style="background:#27ae60;color:#fff;border:none;padding:10px 12px;border-radius:8px;cursor:pointer">G·ª£i √Ω ng·∫´u nhi√™n</button></div>
        <div class="footer-note">L∆∞u √Ω: b·∫£n ƒë·ªì c·∫ßn Google Maps API Key ho·∫°t ƒë·ªông.</div>
      </div>

      <div class="right">
        <h3 style="color:var(--accent);margin-top:0">Khuy·∫øn m·∫°i h√¥m nay</h3>
        <div id="promos"></div>
      </div>
    </div>
  </div>

  <div id="mapModal" class="map-modal">
    <div class="map-header"><div id="mapTitle">B·∫£n ƒë·ªì</div><button class="btn-close" onclick="closeMap()">ƒê√≥ng</button></div>
    <div id="map"></div>
  </div>

<script>
const GOOGLE_API_KEY = "AIzaSyA0KKa4ysubldgYy00jXdD_8vrJJdhRfCQ";
let userLat=null,userLon=null,detectedCountry='VN',currentMeal='lunch';
let map, geocoder, markers=[];

function detectCountryFallback(){const lang=(navigator.language||'').toLowerCase();if(lang.startsWith('vi'))return'VN';if(lang.startsWith('ja'))return'JP';if(lang.startsWith('fr'))return'FR';if(lang.startsWith('de'))return'DE';if(lang.startsWith('en'))return'US';return'VN';}
function updateStatus(msg){document.getElementById('status').innerText='T√¨nh tr·∫°ng: '+msg;}

function initMap(){geocoder=new google.maps.Geocoder();map=new google.maps.Map(document.getElementById('map'),{center:{lat:21.0278,lng:105.8342},zoom:13});}

document.addEventListener('DOMContentLoaded',()=>{selectMeal('lunch');renderPromos();});

function selectMeal(meal){currentMeal=meal;['morning','lunch','dinner'].forEach(m=>document.getElementById('tab-'+m).classList.toggle('active',m===meal));document.getElementById('mealTitle').innerText=meal==='morning'?'Bu·ªïi s√°ng':meal==='lunch'?'Bu·ªïi tr∆∞a':'Bu·ªïi t·ªëi';renderCards();}

function renderCards(){
  const container=document.getElementById('cards');
  container.innerHTML='<div style="text-align:center;color:#999">ƒêang t·∫£i d·ªØ li·ªáu m√≥n ƒÉn...</div>';
  setTimeout(()=>{container.innerHTML='<div class="card"><div class="thumb"><img src="assets/Pho_Thinh.jpg" style="width:100%;height:100%;object-fit:cover"/></div><div class="info"><h4>Ph·ªü b√≤</h4><div class="sub">Ph·ªü Th√¨n ‚Ä¢ H√† N·ªôi</div></div><button onclick="openMapFor(`Ph·ªü Th√¨n`,`13 L√≤ ƒê√∫c, H√† N·ªôi`)" style="background:var(--accent);color:#fff;border:none;padding:8px;border-radius:8px;cursor:pointer">Maps</button></div>';},800);
}

function renderPromos(){document.getElementById('promos').innerHTML='<div class="promo"><strong>Gi·∫£m 10% cho combo Ph·ªü Cu·ªën</strong><div class="small">Ph·ªü Cu·ªën H∆∞∆°ng B·∫øn ¬∑ 26 Nguy·ªÖn Kh·∫Øc Hi·∫øu ¬∑ 350m</div></div>';}

function openMapFor(shop,addr){
  document.getElementById('mapModal').style.display='flex';
  if(!map||!geocoder){initMap();}
  geocoder.geocode({address:addr},(results,status)=>{
    if(status==='OK'&&results[0]){
      map.setCenter(results[0].geometry.location);
      map.setZoom(14);
      new google.maps.Marker({map:map,position:results[0].geometry.location,title:shop});
    }
  });
}

function closeMap(){document.getElementById('mapModal').style.display='none';}

function getUserLocation(){
  if(!navigator.geolocation){alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.');return;}
  updateStatus('ƒêang l·∫•y v·ªã tr√≠...');
  navigator.geolocation.getCurrentPosition(pos=>{
    userLat=pos.coords.latitude;userLon=pos.coords.longitude;
    updateStatus('ƒê√£ l·∫•y v·ªã tr√≠: '+userLat.toFixed(4)+', '+userLon.toFixed(4));
  },err=>{updateStatus('Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠.');});
}
function useManualAddress(){alert('Ch·ª©c nƒÉng nh·∫≠p ƒë·ªãa ch·ªâ ƒëang ho·∫°t ƒë·ªông.');}
function shuffleSuggestion(){alert('G·ª£i √Ω m√≥n ng·∫´u nhi√™n: Ph·ªü b√≤, B√∫n ch·∫£, C∆°m rang...');}
function refreshAll(){updateStatus('Ch∆∞a x√°c ƒë·ªãnh v·ªã tr√≠');document.getElementById('manualAddress').value='';}
</script>

<script async defer loading="async" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0KKa4ysubldgYy00jXdD_8vrJJdhRfCQ&callback=initMap&libraries=places"></script>
</body>
</html>
